<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Random group</title>
  <!-- <link rel="stylesheet" href="../css/reset.css"> -->
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <script src="../js/jquery.min.js"></script>
  <style>
    /* =global */
    html { font-size: 62.5%; }
    h1 { font-size: 1.8rem; }
    
    .container {
      margin: 0 auto;
      width: 80%;
      min-width: 320px;
      max-width: 640px;
    }
    
    .group {
      border: 1px solid lightgrey;
      padding: 20px;
      border-radius: 12px;
    }
    
    h1 {
      margin: 20px 0;
    }
    
    input#jsonInput {
      margin-bottom: 24px;
    }
    
  </style>
</head>
<body>
  
  <div class="container">
    <h1>Random Group Generator</h1>
    
    
  </div>
  
  <script>
    // features to add
    // - ability to remove person absent?
    // - ex. 14 people: [6, 5, 3] or [6, 4, 4]
    
    // inputs from user
    // 1. roster (what class)
    // 2. groupsize
    
    $(document).ready(function() {
      
      // read in the JSON file. for final, should be uploadable
      $.getJSON("data/roster.json", function(data) {
        var semester = data[0].semester;
        var classes = data[0].classes;
        var myClass = classes[0]; // for testing
        var className = myClass.title;
        var classDay = myClass.day;
        var classStudents = myClass.students;
        var groupCount = getGroupCount(classStudents.length, 4); 
        console.log(groupCount); // how many groups?
        // randomize the roster, and assign student to each group
        var groups = createGroups(groupCount, classStudents);
        console.log(groups);
        
      });
      
    });
    
    // create an array with necessary number of people for each group.
    function getGroupCount(total, groupsize) {
      var waiting = total;
      var numG1 = -1;
      var numG2 = -1;
      
      // error checking
      if (total <= 0 || groupsize < 2 || total < groupsize) {
        console.log("numbers don't match...");
        return;
      }
      
      numG1 = Math.floor( waiting / groupsize ); // set numG1 to max value
      while (waiting > 0) { // until everyone gets assigned
        waiting = total - (numG1 * groupsize); // first, assign every possible person
        if (waiting % (groupsize - 1) == 0) { // in perfect case scenario
          numG2 = waiting / (groupsize - 1);
          waiting = 0; // everyone is happy
        } else { // Nah...simple math didn't work, let's reduce number of first group
          numG1--; // one by one until there's no remainder.
          if (numG1 <= 0) { // in case this is not possible
            console.log("can't complete...");
            return;
          }
        }  
      }
      
      var result = [];
      for (var i = 0; i < numG1; i++) {
        result.push( groupsize );
      }
      for (var i = 0; i < numG2; i++) {
        result.push( groupsize - 1 );
      }
      
      return result;
    }
    
    // Durstenfeld shuffle (A computer-optimized version of Fisher-Yates)
    function shuffleArray(array) {
      for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
      }
      return array;
    }
    
    // create array(result) of array(template) with names of people
    function createGroups(template, names) {
      // 1. randomize names array
      // 2. assign one by one into each group
      // 3. return the result
      
      names = shuffleArray(names);
      
      var count = 0;
      var result = [];
      for (var i = 0; i < template.length; i++) {
        var group = [];
        for (var j = 0; j < template[i]; j++) {
          group.push(names[count]);
          count++;
          if (count > names.length) {
            console.log("lengths don't match...");
            break;
          }
        }
        result.push(group);
      }
      return result;
    }

  </script>
</body>
</html>